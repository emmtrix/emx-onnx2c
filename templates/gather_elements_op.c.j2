static inline void {{ op_name }}(const {{ c_type }} {{ data }}{{ data_suffix }}, const {{ indices_c_type }} {{ indices }}{{ indices_suffix }}, {{ c_type }} {{ output }}{{ output_suffix }}) {
{% for dim in output_shape %}
{{ loop_indents[loop.index0] }}for (size_t {{ loop_vars[loop.index0] }} = 0; {{ loop_vars[loop.index0] }} < {{ dim }}; ++{{ loop_vars[loop.index0] }}) {
{% endfor %}
{{ inner_indent }}int64_t gather_index = (int64_t){{ indices }}{% for var in loop_vars %}[{{ var }}]{% endfor %};
{{ inner_indent }}if (gather_index < 0) {
{{ inner_indent }}    gather_index += {{ axis_dim }};
{{ inner_indent }}}
{{ inner_indent }}{{ output }}{% for var in loop_vars %}[{{ var }}]{% endfor %} = {{ data }}{% for idx in data_indices %}[{{ idx }}]{% endfor %};
{% for _ in output_shape %}
{{ loop_indents[loop.revindex0] }}}
{% endfor %}
}
