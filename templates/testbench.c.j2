static uint64_t rng_state = 0x243f6a8885a308d3ull;

static uint64_t rng_next_u64(void) {
    uint64_t x = rng_state;
    x ^= x >> 12;
    x ^= x << 25;
    x ^= x >> 27;
    rng_state = x;
    return x * 0x2545f4914f6cdd1dull;
}

static float rng_next_float(void) {
    return (float)((double)rng_next_u64() * (1.0 / 18446744073709551616.0));
}

static int64_t rng_next_i64(void) {
    return (int64_t)rng_next_u64();
}

int main(void) {
{% for input in inputs %}
    {{ input.c_type }} {{ input.name }}{{ input.array_suffix }};
    {{ input.c_type }} *{{ input.name }}_ptr = ({{ input.c_type }} *){{ input.name }};
    for (size_t i = 0; i < {{ input.count }}; ++i) {
        {{ input.name }}_ptr[i] = {{ input.random_expr }};
    }
{% endfor %}
    {{ output.c_type }} {{ output.name }}{{ output.array_suffix }};
    {{ output.c_type }} *{{ output.name }}_ptr = ({{ output.c_type }} *){{ output.name }};
    {{ model_name }}({% for input in inputs %}{{ input.name }}, {% endfor %}{{ output.name }});
    printf("{\"inputs\":{");
{% for input in inputs %}
{% if not loop.first %}
    printf(",");
{% endif %}
    printf("\"{{ input.name }}\":{\"shape\":[{{ input.shape_literal }}],\"data\":");
    printf("[");
{% for depth in range(input.rank) %}
{{ input.loop_indents[depth] }}for (size_t {{ input.loop_vars[depth] }} = 0; {{ input.loop_vars[depth] }} < {{ input.shape[depth] }}; ++{{ input.loop_vars[depth] }}) {
{{ input.loop_indents[depth] }}    if ({{ input.loop_vars[depth] }}) {
{{ input.loop_indents[depth] }}        printf(",");
{{ input.loop_indents[depth] }}    }
{% if depth < input.rank - 1 %}
{{ input.loop_indents[depth] }}    printf("[");
{% endif %}
{% endfor %}
{{ input.inner_indent }}printf("{{ input.print_format }}", {{ input.print_cast }}{{ input.name }}_ptr[{{ input.index_expr }}]);
{% for depth in range(input.rank - 1, -1, -1) %}
{% if depth < input.rank - 1 %}
{{ input.loop_indents[depth] }}    printf("]");
{% endif %}
{{ input.loop_indents[depth] }}}
{% endfor %}
    printf("]}");
{% endfor %}
    printf("},\"output\":{\"name\":\"{{ output.name }}\",\"shape\":[{{ output.shape_literal }}],\"data\":");
    printf("[");
{% for depth in range(output.rank) %}
{{ output.loop_indents[depth] }}for (size_t {{ output.loop_vars[depth] }} = 0; {{ output.loop_vars[depth] }} < {{ output.shape[depth] }}; ++{{ output.loop_vars[depth] }}) {
{{ output.loop_indents[depth] }}    if ({{ output.loop_vars[depth] }}) {
{{ output.loop_indents[depth] }}        printf(",");
{{ output.loop_indents[depth] }}    }
{% if depth < output.rank - 1 %}
{{ output.loop_indents[depth] }}    printf("[");
{% endif %}
{% endfor %}
{{ output.inner_indent }}printf("{{ output.print_format }}", {{ output.print_cast }}{{ output.name }}_ptr[{{ output.index_expr }}]);
{% for depth in range(output.rank - 1, -1, -1) %}
{% if depth < output.rank - 1 %}
{{ output.loop_indents[depth] }}    printf("]");
{% endif %}
{{ output.loop_indents[depth] }}}
{% endfor %}
    printf("]}}\n");
    return 0;
}
