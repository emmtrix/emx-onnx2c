static uint64_t rng_state = 0x243f6a8885a308d3ull;

static uint64_t rng_next_u64(void) {
    uint64_t x = rng_state;
    x ^= x >> 12;
    x ^= x << 25;
    x ^= x >> 27;
    rng_state = x;
    return x * 0x2545f4914f6cdd1dull;
}

static float rng_next_float(void) {
    return (float)((double)rng_next_u64() * (1.0 / 18446744073709551616.0));
}

static double rng_next_double(void) {
    return (double)rng_next_u64() * (1.0 / 18446744073709551616.0);
}

static int64_t rng_next_i64(void) {
    return (int64_t)rng_next_u64();
}

{% for input in inputs %}
{% if input.constant_lines %}
static const {{ input.c_type }} {{ input.constant_name }}[] = {
{% for line in input.constant_lines %}
    {{ line }}{% if not loop.last %},{% endif %}
{% endfor %}
};
{% endif %}
{% endfor %}

int main(void) {
{% for dim in dim_args %}
    int {{ dim.name }} = {{ dim.value }};
{% endfor %}
{% for input in inputs %}
    {{ input.c_type }} {{ input.name }}{{ input.array_suffix }};
    {{ input.c_type }} *{{ input.name }}_ptr = ({{ input.c_type }} *){{ input.name }};
    for (idx_t i = 0; i < {{ input.count }}; ++i) {
{% if input.constant_name %}
        {{ input.name }}_ptr[i] = {{ input.constant_name }}[i];
{% else %}
        {{ input.name }}_ptr[i] = {{ input.random_expr }};
{% endif %}
    }
{% endfor %}
{% for output in outputs %}
    {{ output.c_type }} {{ output.name }}{{ output.array_suffix }};
    {{ output.c_type }} *{{ output.name }}_ptr = ({{ output.c_type }} *){{ output.name }};
{% endfor %}
    {{ model_name }}({% for dim in dim_args %}{{ dim.name }}, {% endfor %}{% for input in inputs %}{{ input.name }}, {% endfor %}{% for output in outputs %}{{ output.name }}{% if not loop.last %}, {% endif %}{% endfor %});
    printf("{\"inputs\":{");
{% for input in inputs %}
{% if not loop.first %}
    printf(",");
{% endif %}
    printf("\"{{ input.name }}\":{\"shape\":[{{ input.shape_literal }}],\"data\":");
    printf("[");
{% for depth in range(input.rank) %}
for (idx_t {{ input.loop_vars[depth] }} = 0; {{ input.loop_vars[depth] }} < {{ input.shape[depth] }}; ++{{ input.loop_vars[depth] }}) {
    if ({{ input.loop_vars[depth] }}) {
        printf(",");
    }
{% if depth < input.rank - 1 %}
    printf("[");
{% endif %}
{% endfor %}
printf("{{ input.print_format }}", {{ input.print_cast }}{{ input.name }}_ptr[{{ input.index_expr }}]);
{% for depth in range(input.rank - 1, -1, -1) %}
{% if depth < input.rank - 1 %}
    printf("]");
{% endif %}
}
{% endfor %}
    printf("]}");
{% endfor %}
    printf("},\"outputs\":{");
{% for output in outputs %}
{% if not loop.first %}
    printf(",");
{% endif %}
    printf("\"{{ output.name }}\":{\"shape\":[{{ output.shape_literal }}],\"data\":");
    printf("[");
{% for depth in range(output.rank) %}
for (idx_t {{ output.loop_vars[depth] }} = 0; {{ output.loop_vars[depth] }} < {{ output.shape[depth] }}; ++{{ output.loop_vars[depth] }}) {
    if ({{ output.loop_vars[depth] }}) {
        printf(",");
    }
{% if depth < output.rank - 1 %}
    printf("[");
{% endif %}
{% endfor %}
printf("{{ output.print_format }}", {{ output.print_cast }}{{ output.name }}_ptr[{{ output.index_expr }}]);
{% for depth in range(output.rank - 1, -1, -1) %}
{% if depth < output.rank - 1 %}
    printf("]");
{% endif %}
}
{% endfor %}
    printf("]}");
{% endfor %}
    printf("}}\n");
    return 0;
}
