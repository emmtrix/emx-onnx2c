static inline void {{ op_name }}({{ dim_args }}{{ params | join(', ') }}) {
    for (size_t n = 0; n < {{ batch }}; ++n) {
        for (size_t c = 0; c < {{ channels }}; ++c) {
            for (size_t oh = 0; oh < {{ out_h }}; ++oh) {
                for (size_t ow = 0; ow < {{ out_w }}; ++ow) {
                    {{ c_type }} acc = {{ zero_literal }};
                    size_t count = 0;
                    for (size_t kh = 0; kh < {{ kernel_h }}; ++kh) {
                        const int ih = (int)(oh * {{ stride_h }} + kh) - {{ pad_top }};
                        if (ih < 0 || ih >= {{ in_h }}) {
                            if ({{ count_include_pad }}) {
                                count += {{ kernel_w }};
                            }
                            continue;
                        }
                        for (size_t kw = 0; kw < {{ kernel_w }}; ++kw) {
                            const int iw = (int)(ow * {{ stride_w }} + kw) - {{ pad_left }};
                            if (iw < 0 || iw >= {{ in_w }}) {
                                if ({{ count_include_pad }}) {
                                    count += 1;
                                }
                                continue;
                            }
                            acc += {{ input0 }}[n][c][ih][iw];
                            count += 1;
                        }
                    }
                    {{ output }}[n][c][oh][ow] = count ? acc / ({{ c_type }})count : {{ zero_literal }};
                }
            }
        }
    }
}
