void {{ op_name }}(const {{ c_type }} {{ input0 }}{{ input_suffix }}, const {{ c_type }} {{ weights }}{{ weight_suffix }},{% if bias %} const {{ c_type }} {{ bias }}{{ bias_suffix }},{% endif %} {{ c_type }} {{ output }}{{ output_suffix }}) {
    for (size_t n = 0; n < {{ batch }}; ++n) {
        for (size_t oc = 0; oc < {{ out_channels }}; ++oc) {
            for (size_t oh = 0; oh < {{ out_h }}; ++oh) {
                for (size_t ow = 0; ow < {{ out_w }}; ++ow) {
                    {{ c_type }} acc = {% if bias %}{{ bias }}[oc]{% else %}{{ zero_literal }}{% endif %};
                    for (size_t ic = 0; ic < {{ in_channels }}; ++ic) {
                        for (size_t kh = 0; kh < {{ kernel_h }}; ++kh) {
                            const int ih = (int)(oh * {{ stride_h }} + kh * {{ dilation_h }}) - {{ pad_top }};
                            if (ih < 0 || ih >= {{ in_h }}) {
                                continue;
                            }
                            for (size_t kw = 0; kw < {{ kernel_w }}; ++kw) {
                                const int iw = (int)(ow * {{ stride_w }} + kw * {{ dilation_w }}) - {{ pad_left }};
                                if (iw < 0 || iw >= {{ in_w }}) {
                                    continue;
                                }
                                acc += {{ input0 }}[n][ic][ih][iw] * {{ weights }}[oc][ic][kh][kw];
                            }
                        }
                    }
                    {{ output }}[n][oc][oh][ow] = acc;
                }
            }
        }
    }
}
