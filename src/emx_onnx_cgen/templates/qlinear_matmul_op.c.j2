static inline void {{ op_name }}({{ dim_args }}{{ params | join(', ') }}) {
{% if scale_is_float16 %}
    const {{ scale_type }} scale_product = ({{ scale_type }})((( {{ scale_type }}){{ input0_scale_expr }}) * (({{ scale_type }}){{ input1_scale_expr }}));
    const {{ scale_type }} scale = ({{ scale_type }})(scale_product / ({{ scale_type }}){{ output_scale_expr }});
{% else %}
    const {{ scale_type }} scale = (({{ scale_type }}){{ input0_scale_expr }}) * (({{ scale_type }}){{ input1_scale_expr }}) / (({{ scale_type }}){{ output_scale_expr }});
{% endif %}
    const int32_t input0_zero = (int32_t){{ input0_zero_expr }};
    const int32_t input1_zero = (int32_t){{ input1_zero_expr }};
    const {{ compute_type }} output_zero = ({{ compute_type }}){{ output_zero_expr }};
{% for idx in range(output_loop_vars | length) %}
    {% for indent in range(loop.index0) %}    {% endfor %}for (idx_t {{ output_loop_vars[idx] }} = 0; {{ output_loop_vars[idx] }} < {{ output_loop_bounds[idx] }}; ++{{ output_loop_vars[idx] }}) {
{% endfor %}
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}int32_t acc = 0;
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}for (idx_t k = 0; k < {{ k }}; ++k) {
            {% for indent in range(output_loop_vars | length + 1) %}    {% endfor %}acc += ((int32_t){{ input0_index_expr }} - input0_zero) * ((int32_t){{ input1_index_expr }} - input1_zero);
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}}
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}{{ compute_type }} scaled = (({{ compute_type }})acc) * scale + output_zero;
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}{{ compute_type }} rounded = {{ round_fn }}(scaled);
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}{{ compute_type }} wrapped = {{ mod_fn }}(rounded, ({{ compute_type }})256.0);
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}if (wrapped < ({{ compute_type }})0.0) {
            {% for indent in range(output_loop_vars | length + 1) %}    {% endfor %}wrapped += ({{ compute_type }})256.0;
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}}
{% if output_is_signed %}
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}if (wrapped >= ({{ compute_type }})128.0) {
            {% for indent in range(output_loop_vars | length + 1) %}    {% endfor %}wrapped -= ({{ compute_type }})256.0;
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}}
{% endif %}
        {% for indent in range(output_loop_vars | length) %}    {% endfor %}{{ output_index_expr }} = ({{ output_c_type }})wrapped;
{% for idx in range(output_loop_vars | length) | reverse %}
    {% for indent in range(loop.index0) %}    {% endfor %}}
{% endfor %}
}
